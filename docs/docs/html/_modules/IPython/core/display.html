<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.09.29"/>
        <title>IPython.core.display - Peloptimize documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Peloptimize  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky">
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for IPython.core.display</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;Top-level display functions for displaying object in different formats.&quot;&quot;&quot;</span>

<span class="c1"># Copyright (c) IPython Development Team.</span>
<span class="c1"># Distributed under the terms of the Modified BSD License.</span>


<span class="kn">from</span> <span class="nn">binascii</span> <span class="kn">import</span> <span class="n">b2a_hex</span><span class="p">,</span> <span class="n">b2a_base64</span><span class="p">,</span> <span class="n">hexlify</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span>

<span class="kn">from</span> <span class="nn">IPython.utils.py3compat</span> <span class="kn">import</span> <span class="n">cast_unicode</span>
<span class="kn">from</span> <span class="nn">IPython.testing.skipdoctest</span> <span class="kn">import</span> <span class="n">skip_doctest</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;display_pretty&#39;</span><span class="p">,</span> <span class="s1">&#39;display_html&#39;</span><span class="p">,</span> <span class="s1">&#39;display_markdown&#39;</span><span class="p">,</span>
<span class="s1">&#39;display_svg&#39;</span><span class="p">,</span> <span class="s1">&#39;display_png&#39;</span><span class="p">,</span> <span class="s1">&#39;display_jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;display_latex&#39;</span><span class="p">,</span> <span class="s1">&#39;display_json&#39;</span><span class="p">,</span>
<span class="s1">&#39;display_javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;display_pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;DisplayObject&#39;</span><span class="p">,</span> <span class="s1">&#39;TextDisplayObject&#39;</span><span class="p">,</span>
<span class="s1">&#39;Pretty&#39;</span><span class="p">,</span> <span class="s1">&#39;HTML&#39;</span><span class="p">,</span> <span class="s1">&#39;Markdown&#39;</span><span class="p">,</span> <span class="s1">&#39;Math&#39;</span><span class="p">,</span> <span class="s1">&#39;Latex&#39;</span><span class="p">,</span> <span class="s1">&#39;SVG&#39;</span><span class="p">,</span> <span class="s1">&#39;ProgressBar&#39;</span><span class="p">,</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
<span class="s1">&#39;GeoJSON&#39;</span><span class="p">,</span> <span class="s1">&#39;Javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;Image&#39;</span><span class="p">,</span> <span class="s1">&#39;clear_output&#39;</span><span class="p">,</span> <span class="s1">&#39;set_matplotlib_formats&#39;</span><span class="p">,</span>
<span class="s1">&#39;set_matplotlib_close&#39;</span><span class="p">,</span> <span class="s1">&#39;publish_display_data&#39;</span><span class="p">,</span> <span class="s1">&#39;update_display&#39;</span><span class="p">,</span> <span class="s1">&#39;DisplayHandle&#39;</span><span class="p">,</span>
<span class="s1">&#39;Video&#39;</span><span class="p">]</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># utility functions</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="k">def</span> <span class="nf">_safe_exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check path, but don&#39;t let exceptions raise&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Like update, but merges sub-dicts instead of clobbering at the top level.</span>

<span class="sd">    Updates d1 in-place</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d2</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">d2</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">d1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_merge</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d1</span>

<span class="k">def</span> <span class="nf">_display_mimetype</span><span class="p">(</span><span class="n">mimetype</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;internal implementation of all display_foo methods</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mimetype : str</span>
<span class="sd">        The mimetype to be published (e.g. &#39;image/png&#39;)</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw text data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="n">metadata</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="c1"># turn list of pngdata into list of { &#39;image/png&#39;: pngdata }</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="n">obj</span><span class="p">}</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span> <span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="n">raw</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">mimetype</span><span class="p">])</span>

<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Main functions</span>
<span class="c1">#-----------------------------------------------------------------------------</span>

<span class="c1"># use * to indicate transient is keyword-only</span>
<span class="k">def</span> <span class="nf">publish_display_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">transient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Publish data and metadata to all frontends.</span>

<span class="sd">    See the ``display_data`` message in the messaging documentation for</span>
<span class="sd">    more details about this message type.</span>

<span class="sd">    Keys of data and metadata can be any mime-type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : dict</span>
<span class="sd">        A dictionary having keys that are valid MIME types (like</span>
<span class="sd">        &#39;text/plain&#39; or &#39;image/svg+xml&#39;) and values that are the data for</span>
<span class="sd">        that MIME type. The data itself must be a JSON&#39;able data</span>
<span class="sd">        structure. Minimally all data should have the &#39;text/plain&#39; data,</span>
<span class="sd">        which can be displayed by all frontends. If more than the plain</span>
<span class="sd">        text is given, it is up to the frontend to decide which</span>
<span class="sd">        representation to use.</span>
<span class="sd">    metadata : dict</span>
<span class="sd">        A dictionary for metadata related to the data. This can contain</span>
<span class="sd">        arbitrary key, value pairs that frontends can use to interpret</span>
<span class="sd">        the data. mime-type keys matching those in data can be used</span>
<span class="sd">        to specify metadata about particular representations.</span>
<span class="sd">    source : str, deprecated</span>
<span class="sd">        Unused.</span>
<span class="sd">    transient : dict, keyword-only</span>
<span class="sd">        A dictionary of transient data, such as display_id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>

    <span class="n">display_pub</span> <span class="o">=</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_pub</span>

    <span class="c1"># only pass transient if supplied,</span>
    <span class="c1"># to avoid errors with older ipykernel.</span>
    <span class="c1"># TODO: We could check for ipykernel version and provide a detailed upgrade message.</span>
    <span class="k">if</span> <span class="n">transient</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;transient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transient</span>

    <span class="n">display_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_new_id</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a new random text id with urandom&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">b2a_hex</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display a Python object in all frontends.</span>

<span class="sd">    By default all representations will be computed and sent to the frontends.</span>
<span class="sd">    Frontends can decide which representation is used and how.</span>

<span class="sd">    In terminal IPython this will be similar to using :func:`print`, for use in richer</span>
<span class="sd">    frontends see Jupyter notebook examples with rich display logic.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display.</span>
<span class="sd">    raw : bool, optional</span>
<span class="sd">        Are the objects to be displayed already mimetype-keyed dicts of raw display data,</span>
<span class="sd">        or Python objects that need to be formatted before display? [default: False]</span>
<span class="sd">    include : list, tuple or set, optional</span>
<span class="sd">        A list of format type strings (MIME types) to include in the</span>
<span class="sd">        format data dict. If this is set *only* the format types included</span>
<span class="sd">        in this list will be computed.</span>
<span class="sd">    exclude : list, tuple or set, optional</span>
<span class="sd">        A list of format type strings (MIME types) to exclude in the format</span>
<span class="sd">        data dict. If this is set all format types will be computed,</span>
<span class="sd">        except for those included in this argument.</span>
<span class="sd">    metadata : dict, optional</span>
<span class="sd">        A dictionary of metadata to associate with the output.</span>
<span class="sd">        mime-type keys in this dictionary will be associated with the individual</span>
<span class="sd">        representation formats, if they exist.</span>
<span class="sd">    transient : dict, optional</span>
<span class="sd">        A dictionary of transient data to associate with the output.</span>
<span class="sd">        Data in this dict should not be persisted to files (e.g. notebooks).</span>
<span class="sd">    display_id : str, bool optional</span>
<span class="sd">        Set an id for the display.</span>
<span class="sd">        This id can be used for updating this display area later via update_display.</span>
<span class="sd">        If given as `True`, generate a new `display_id`</span>
<span class="sd">    clear : bool, optional</span>
<span class="sd">        Should the output area be cleared before displaying anything? If True,</span>
<span class="sd">        this will wait for additional output before clearing. [default: False]</span>
<span class="sd">    kwargs: additional keyword-args, optional</span>
<span class="sd">        Additional keyword-arguments are passed through to the display publisher.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    handle: DisplayHandle</span>
<span class="sd">        Returns a handle on updatable displays for use with :func:`update_display`,</span>
<span class="sd">        if `display_id` is given. Returns :any:`None` if no `display_id` is given</span>
<span class="sd">        (default).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; class Json(object):</span>
<span class="sd">    ...     def __init__(self, json):</span>
<span class="sd">    ...         self.json = json</span>
<span class="sd">    ...     def _repr_pretty_(self, pp, cycle):</span>
<span class="sd">    ...         import json</span>
<span class="sd">    ...         pp.text(json.dumps(self.json, indent=2))</span>
<span class="sd">    ...     def __repr__(self):</span>
<span class="sd">    ...         return str(self.json)</span>
<span class="sd">    ...</span>

<span class="sd">    &gt;&gt;&gt; d = Json({1:2, 3: {4:5}})</span>

<span class="sd">    &gt;&gt;&gt; print(d)</span>
<span class="sd">    {1: 2, 3: {4: 5}}</span>

<span class="sd">    &gt;&gt;&gt; display(d)</span>
<span class="sd">    {</span>
<span class="sd">      &quot;1&quot;: 2,</span>
<span class="sd">      &quot;3&quot;: {</span>
<span class="sd">        &quot;4&quot;: 5</span>
<span class="sd">      }</span>
<span class="sd">    }</span>

<span class="sd">    &gt;&gt;&gt; def int_formatter(integer, pp, cycle):</span>
<span class="sd">    ...     pp.text(&#39;I&#39;*integer)</span>

<span class="sd">    &gt;&gt;&gt; plain = get_ipython().display_formatter.formatters[&#39;text/plain&#39;]</span>
<span class="sd">    &gt;&gt;&gt; plain.for_type(int, int_formatter)</span>
<span class="sd">    &lt;function _repr_pprint at 0x...&gt;</span>
<span class="sd">    &gt;&gt;&gt; display(7-5)</span>
<span class="sd">    II</span>

<span class="sd">    &gt;&gt;&gt; del plain.type_printers[int]</span>
<span class="sd">    &gt;&gt;&gt; display(7-5)</span>
<span class="sd">    2</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    :func:`update_display`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    In Python, objects can declare their textual representation using the</span>
<span class="sd">    `__repr__` method. IPython expands on this idea and allows objects to declare</span>
<span class="sd">    other, rich representations including:</span>

<span class="sd">      - HTML</span>
<span class="sd">      - JSON</span>
<span class="sd">      - PNG</span>
<span class="sd">      - JPEG</span>
<span class="sd">      - SVG</span>
<span class="sd">      - LaTeX</span>

<span class="sd">    A single object can declare some or all of these representations; all are</span>
<span class="sd">    handled by IPython&#39;s display system.</span>

<span class="sd">    The main idea of the first approach is that you have to implement special</span>
<span class="sd">    display methods when you define your class, one for each representation you</span>
<span class="sd">    want to use. Here is a list of the names of the special methods and the</span>
<span class="sd">    values they must return:</span>

<span class="sd">      - `_repr_html_`: return raw HTML as a string, or a tuple (see below).</span>
<span class="sd">      - `_repr_json_`: return a JSONable dict, or a tuple (see below).</span>
<span class="sd">      - `_repr_jpeg_`: return raw JPEG data, or a tuple (see below).</span>
<span class="sd">      - `_repr_png_`: return raw PNG data, or a tuple (see below).</span>
<span class="sd">      - `_repr_svg_`: return raw SVG data as a string, or a tuple (see below).</span>
<span class="sd">      - `_repr_latex_`: return LaTeX commands in a string surrounded by &quot;$&quot;,</span>
<span class="sd">                        or a tuple (see below).</span>
<span class="sd">      - `_repr_mimebundle_`: return a full mimebundle containing the mapping</span>
<span class="sd">                             from all mimetypes to data.</span>
<span class="sd">                             Use this for any mime-type not listed above.</span>

<span class="sd">    The above functions may also return the object&#39;s metadata alonside the</span>
<span class="sd">    data.  If the metadata is available, the functions will return a tuple</span>
<span class="sd">    containing the data and metadata, in that order.  If there is no metadata</span>
<span class="sd">    available, then the functions will return the data only.</span>

<span class="sd">    When you are directly writing your own classes, you can adapt them for</span>
<span class="sd">    display in IPython by following the above approach. But in practice, you</span>
<span class="sd">    often need to work with existing classes that you can&#39;t easily modify.</span>

<span class="sd">    You can refer to the documentation on integrating with the display system in</span>
<span class="sd">    order to register custom formatters for already existing types</span>
<span class="sd">    (:ref:`integrating_rich_display`).</span>

<span class="sd">    .. versionadded:: 5.4 display available without import</span>
<span class="sd">    .. versionadded:: 6.1 display available without import</span>

<span class="sd">    Since IPython 5.4 and 6.1 :func:`display` is automatically made available to</span>
<span class="sd">    the user without import. If you are using display in a document that might</span>
<span class="sd">    be used in a pure python context or with older version of IPython, use the</span>
<span class="sd">    following import at the top of your file::</span>

<span class="sd">        from IPython.display import display</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">initialized</span><span class="p">():</span>
        <span class="c1"># Directly print objects.</span>
        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">raw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;raw&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">clear</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;clear&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transient</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">transient</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">if</span> <span class="n">display_id</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">display_id</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">display_id</span> <span class="o">=</span> <span class="n">_new_id</span><span class="p">()</span>
        <span class="n">transient</span><span class="p">[</span><span class="s1">&#39;display_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">display_id</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;display_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">transient</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;display_id required for update_display&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">transient</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;transient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transient</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">objs</span> <span class="ow">and</span> <span class="n">display_id</span><span class="p">:</span>
        <span class="c1"># if given no objects, but still a request for a display_id,</span>
        <span class="c1"># we assume the user wants to insert an empty output that</span>
        <span class="c1"># can be updated later</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[{}]</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">raw</span><span class="p">:</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_formatter</span><span class="o">.</span><span class="n">format</span>

    <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">publish_display_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format_dict</span><span class="p">,</span> <span class="n">md_dict</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">format_dict</span><span class="p">:</span>
                <span class="c1"># nothing to display (e.g. _ipython_display_ took over)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="c1"># kwarg-specified metadata gets precedence</span>
                <span class="n">_merge</span><span class="p">(</span><span class="n">md_dict</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
            <span class="n">publish_display_data</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">format_dict</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">md_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">display_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DisplayHandle</span><span class="p">(</span><span class="n">display_id</span><span class="p">)</span>


<span class="c1"># use * for keyword-only display_id arg</span>
<span class="k">def</span> <span class="nf">update_display</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">display_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update an existing display by id</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    obj:</span>
<span class="sd">        The object with which to update the display</span>
<span class="sd">    display_id: keyword-only</span>
<span class="sd">        The id of the display to update</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    :func:`display`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;update&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">display</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="n">display_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DisplayHandle</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A handle on an updatable display</span>

<span class="sd">    Call `.update(obj)` to display a new object.</span>

<span class="sd">    Call `.display(obj`) to add a new instance of this display,</span>
<span class="sd">    and update existing instances.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">        :func:`display`, :func:`update_display`</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">display_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">display_id</span> <span class="o">=</span> <span class="n">_new_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_id</span> <span class="o">=</span> <span class="n">display_id</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2"> display_id=</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a new display with my id, updating existing instances.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        obj:</span>
<span class="sd">            object to display</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            additional keyword arguments passed to display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">display</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">display_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update existing displays with my id</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        obj:</span>
<span class="sd">            object to display</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            additional keyword arguments passed to update_display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_display</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">display_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_pretty</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the pretty (default) representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw text data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_html</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the HTML representation of an object.</span>

<span class="sd">    Note: If raw=False and the object does not have a HTML</span>
<span class="sd">    representation, no HTML will be shown.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw HTML data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_markdown</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays the Markdown representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw markdown data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;text/markdown&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_svg</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the SVG representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw svg data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;image/svg+xml&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_png</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the PNG representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw png data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;image/png&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_jpeg</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the JPEG representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw JPEG data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_latex</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the LaTeX representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw latex data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;text/latex&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_json</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the JSON representation of an object.</span>

<span class="sd">    Note that not many frontends support displaying JSON.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw json data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_javascript</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the Javascript representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw javascript data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;application/javascript&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">display_pdf</span><span class="p">(</span><span class="o">*</span><span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display the PDF representation of an object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *objs : object</span>
<span class="sd">        The Python objects to display, or if raw=True raw javascript data to</span>
<span class="sd">        display.</span>
<span class="sd">    raw : bool</span>
<span class="sd">        Are the data objects raw data or Python objects that need to be</span>
<span class="sd">        formatted before display? [default: False]</span>
<span class="sd">    metadata : dict (optional)</span>
<span class="sd">        Metadata to be associated with the specific mimetype output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_display_mimetype</span><span class="p">(</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="c1">#-----------------------------------------------------------------------------</span>
<span class="c1"># Smart classes</span>
<span class="c1">#-----------------------------------------------------------------------------</span>


<span class="k">class</span> <span class="nc">DisplayObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An object that wraps data to be displayed.&quot;&quot;&quot;</span>

    <span class="n">_read_flags</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
    <span class="n">_show_mem_addr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a display object given raw data.</span>

<span class="sd">        When this object is returned by an expression or passed to the</span>
<span class="sd">        display function, it will result in the data being displayed</span>
<span class="sd">        in the frontend. The MIME type of the data should match the</span>
<span class="sd">        subclasses used, so the Png subclass should be used for &#39;image/png&#39;</span>
<span class="sd">        data. If the data is a URL, the data will first be downloaded</span>
<span class="sd">        and then displayed. If</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The raw data or a URL or file to load the data from</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">        metadata : dict</span>
<span class="sd">            Dict of metadata associated to be the object when displayed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">_safe_exists</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="c1"># because of @data.setter methods in</span>
        <span class="c1"># subclasses ensure url and filename are set</span>
        <span class="c1"># before assigning to self.data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_data</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_mem_addr</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
            <span class="n">r</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> object&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override in subclasses if there&#39;s something to check.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_data_and_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;shortcut for returning metadata with shape information, if defined&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the raw data from file or URL.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_flags</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Deferred import</span>
            <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="c1"># extract encoding from header, if there is one:</span>
            <span class="n">encoding</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;content-type&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
                    <span class="n">sub</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">sub</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;charset&#39;</span><span class="p">):</span>
                        <span class="n">encoding</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="s1">&#39;content-encoding&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                <span class="c1"># TODO: do deflate?</span>
                <span class="k">if</span> <span class="s1">&#39;gzip&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;content-encoding&#39;</span><span class="p">]:</span>
                    <span class="kn">import</span> <span class="nn">gzip</span>
                    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
                    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                        <span class="n">encoding</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="c1"># decode data, if an encoding was specified</span>
            <span class="c1"># We only touch self.data once since</span>
            <span class="c1"># subclasses such as SVG have @data.setter methods</span>
            <span class="c1"># that transform self.data into ... well svg.</span>
            <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">,</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>


<span class="k">class</span> <span class="nc">TextDisplayObject</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that display data is text&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> expects text, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Pretty</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pp</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>


<div class="viewcode-block" id="HTML"><a class="viewcode-back" href="../../../index.html#pelopt.utils.model_module.HTML">[docs]</a><span class="k">class</span> <span class="nc">HTML</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">warn</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1">#</span>
            <span class="c1"># Avoid calling lower() on the entire data, because it could be a</span>
            <span class="c1"># long string and we&#39;re only interested in its beginning and end.</span>
            <span class="c1">#</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;iframe &quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">suffix</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;&lt;/iframe&gt;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">warn</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Consider using IPython.display.IFrame instead&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HTML</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

<div class="viewcode-block" id="HTML.__html__"><a class="viewcode-back" href="../../../index.html#pelopt.utils.model_module.HTML.__html__">[docs]</a>    <span class="k">def</span> <span class="nf">__html__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method exists to inform other HTML-using modules (e.g. Markupsafe,</span>
<span class="sd">        htmltag, etc) that this object is HTML and does not need things like</span>
<span class="sd">        special characters (&lt;&gt;&amp;) escaped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()</span></div></div>


<span class="k">class</span> <span class="nc">Markdown</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_markdown_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Math</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\displaystyle </span><span class="si">%s</span><span class="s2">$&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>


<span class="k">class</span> <span class="nc">Latex</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_repr_latex_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SVG</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Embed an SVG into the display.</span>

<span class="sd">    Note if you just want to view a svg image via a URL use `:class:Image` with</span>
<span class="sd">    a url=URL keyword argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_read_flags</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span>
    <span class="c1"># wrap data in a property, which extracts the &lt;svg&gt; tag, discarding</span>
    <span class="c1"># document headers</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">svg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">svg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="c1"># parse into dom object</span>
        <span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="c1"># get svg tag (should be 1)</span>
        <span class="n">found_svg</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">found_svg</span><span class="p">:</span>
            <span class="n">svg</span> <span class="o">=</span> <span class="n">found_svg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">toxml</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fallback on the input, trust the user</span>
            <span class="c1"># but this is probably an error.</span>
            <span class="k">pass</span>
        <span class="n">svg</span> <span class="o">=</span> <span class="n">cast_unicode</span><span class="p">(</span><span class="n">svg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">svg</span>
    
    <span class="k">def</span> <span class="nf">_repr_svg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">ProgressBar</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Progressbar supports displaying a progressbar like element </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new progressbar</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        total : int</span>
<span class="sd">            maximum size of the progressbar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">total</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_width</span> <span class="o">=</span> <span class="s1">&#39;60ex&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_width</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_id</span> <span class="o">=</span> <span class="n">hexlify</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
        <span class="n">filled</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">fraction</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_width</span><span class="p">)</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_width</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">filled</span><span class="p">))</span>
        <span class="k">return</span> <span class="s1">&#39;[</span><span class="si">{}{}</span><span class="s1">] </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">filled</span><span class="p">,</span> <span class="n">rest</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;progress style=&#39;width:</span><span class="si">{}</span><span class="s2">&#39; max=&#39;</span><span class="si">{}</span><span class="s2">&#39; value=&#39;</span><span class="si">{}</span><span class="s2">&#39;&gt;&lt;/progress&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">html_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_display_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_display_id</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span>

    <span class="nd">@progress</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_progress</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># First iteration is 0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns current value and increments display by one.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">progress</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">JSON</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;JSON expects a JSON-able dict or list</span>

<span class="sd">    not an already-serialized JSON string.</span>

<span class="sd">    Scalar types (None, number, string) are not allowed, only dict or list containers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># wrap data in a property, which warns about passing already-serialized JSON</span>
    <span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expanded</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a JSON display object given raw data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : dict or list</span>
<span class="sd">            JSON data to display. Not an already-serialized JSON string.</span>
<span class="sd">            Scalar types (None, number, string) are not allowed, only dict</span>
<span class="sd">            or list containers.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">        expanded : boolean</span>
<span class="sd">            Metadata to control whether a JSON display component is expanded.</span>
<span class="sd">        metadata: dict</span>
<span class="sd">            Specify extra metadata to attach to the json display object.</span>
<span class="sd">        root : str</span>
<span class="sd">            The name of the root element of the JSON tree </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;expanded&#39;</span><span class="p">:</span> <span class="n">expanded</span><span class="p">,</span>
            <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="n">root</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JSON</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> expects JSONable dict or list, not </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;JSON expects JSONable dict or list, not JSON strings&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">_data_and_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_repr_json_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

<span class="n">_css_t</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;var link = document.createElement(&quot;link&quot;);</span>
<span class="s2">	link.ref = &quot;stylesheet&quot;;</span>
<span class="s2">	link.type = &quot;text/css&quot;;</span>
<span class="s2">	link.href = &quot;</span><span class="si">%s</span><span class="s2">&quot;;</span>
<span class="s2">	document.head.appendChild(link);</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_lib_t1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;new Promise(function(resolve, reject) {</span>
<span class="s2">	var script = document.createElement(&quot;script&quot;);</span>
<span class="s2">	script.onload = resolve;</span>
<span class="s2">	script.onerror = reject;</span>
<span class="s2">	script.src = &quot;</span><span class="si">%s</span><span class="s2">&quot;;</span>
<span class="s2">	document.head.appendChild(script);</span>
<span class="s2">}).then(() =&gt; {</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">_lib_t2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">});&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">GeoJSON</span><span class="p">(</span><span class="n">JSON</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GeoJSON expects JSON-able dict</span>

<span class="sd">    not an already-serialized JSON string.</span>

<span class="sd">    Scalar types (None, number, string) are not allowed, only dict containers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a GeoJSON display object given raw data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : dict or list</span>
<span class="sd">            VegaLite data. Not an already-serialized JSON string.</span>
<span class="sd">            Scalar types (None, number, string) are not allowed, only dict</span>
<span class="sd">            or list containers.</span>
<span class="sd">        url_template : string</span>
<span class="sd">            Leaflet TileLayer URL template: http://leafletjs.com/reference.html#url-template</span>
<span class="sd">        layer_options : dict</span>
<span class="sd">            Leaflet TileLayer options: http://leafletjs.com/reference.html#tilelayer-options</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">        metadata: dict</span>
<span class="sd">            Specify extra metadata to attach to the json display object.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        The following will display an interactive map of Mars with a point of</span>
<span class="sd">        interest on frontend that do support GeoJSON display.</span>

<span class="sd">            &gt;&gt;&gt; from IPython.display import GeoJSON</span>

<span class="sd">            &gt;&gt;&gt; GeoJSON(data={</span>
<span class="sd">            ...     &quot;type&quot;: &quot;Feature&quot;,</span>
<span class="sd">            ...     &quot;geometry&quot;: {</span>
<span class="sd">            ...         &quot;type&quot;: &quot;Point&quot;,</span>
<span class="sd">            ...         &quot;coordinates&quot;: [-81.327, 296.038]</span>
<span class="sd">            ...     }</span>
<span class="sd">            ... },</span>
<span class="sd">            ... url_template=&quot;http://s3-eu-west-1.amazonaws.com/whereonmars.cartodb.net/{basemap_id}/{z}/{x}/{y}.png&quot;,</span>
<span class="sd">            ... layer_options={</span>
<span class="sd">            ...     &quot;basemap_id&quot;: &quot;celestia_mars-shaded-16k_global&quot;,</span>
<span class="sd">            ...     &quot;attribution&quot; : &quot;Celestia/praesepe&quot;,</span>
<span class="sd">            ...     &quot;minZoom&quot; : 0,</span>
<span class="sd">            ...     &quot;maxZoom&quot; : 18,</span>
<span class="sd">            ... })</span>
<span class="sd">            &lt;IPython.core.display.GeoJSON object&gt;</span>

<span class="sd">        In the terminal IPython, you will only see the text representation of</span>
<span class="sd">        the GeoJSON object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">GeoJSON</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_ipython_display_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;application/geo+json&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="s1">&#39;text/plain&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;IPython.display.GeoJSON object&gt;&#39;</span>
        <span class="p">}</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;application/geo+json&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
        <span class="p">}</span>
        <span class="n">display</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Javascript</span><span class="p">(</span><span class="n">TextDisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">css</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Javascript display object given raw data.</span>

<span class="sd">        When this object is returned by an expression or passed to the</span>
<span class="sd">        display function, it will result in the data being displayed</span>
<span class="sd">        in the frontend. If the data is a URL, the data will first be</span>
<span class="sd">        downloaded and then displayed.</span>

<span class="sd">        In the Notebook, the containing element will be available as `element`,</span>
<span class="sd">        and jQuery will be available.  Content appended to `element` will be</span>
<span class="sd">        visible in the output area.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The Javascript source code or a URL to download it from.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">        lib : list or str</span>
<span class="sd">            A sequence of Javascript library URLs to load asynchronously before</span>
<span class="sd">            running the source code. The full URLs of the libraries should</span>
<span class="sd">            be given. A single Javascript library URL can also be given as a</span>
<span class="sd">            string.</span>
<span class="sd">        css: : list or str</span>
<span class="sd">            A sequence of css files to load before running the source code.</span>
<span class="sd">            The full URLs of the css files should be given. A single css URL</span>
<span class="sd">            can also be given as a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">lib</span> <span class="o">=</span> <span class="p">[</span><span class="n">lib</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">lib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lib</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">css</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">css</span> <span class="o">=</span> <span class="p">[</span><span class="n">css</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">css</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">css</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;expected sequence, got: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lib</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">css</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;expected sequence, got: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">css</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">lib</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">css</span> <span class="o">=</span> <span class="n">css</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Javascript</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_javascript_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">css</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="n">_css_t</span> <span class="o">%</span> <span class="n">c</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">+=</span> <span class="n">_lib_t1</span> <span class="o">%</span> <span class="n">l</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="n">r</span> <span class="o">+=</span> <span class="n">_lib_t2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lib</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span>

<span class="c1"># constants for identifying png/jpeg data</span>
<span class="n">_PNG</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x89</span><span class="s1">PNG</span><span class="se">\r\n\x1a\n</span><span class="s1">&#39;</span>
<span class="n">_JPEG</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff\xd8</span><span class="s1">&#39;</span>

<span class="k">def</span> <span class="nf">_pngxy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;read the (width, height) from a PNG header&quot;&quot;&quot;</span>
    <span class="n">ihdr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;IHDR&#39;</span><span class="p">)</span>
    <span class="c1"># next 8 bytes are width/height</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;ii&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">ihdr</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">ihdr</span><span class="o">+</span><span class="mi">12</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_jpegxy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;read the (width, height) from a JPEG header&quot;&quot;&quot;</span>
    <span class="c1"># adapted from http://www.64lines.com/jpeg-width-height</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">block_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">block_size</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xFF\xC0</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="c1"># found Start of Frame</span>
            <span class="n">iSOF</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># read another block</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">iSOF</span><span class="o">+</span><span class="mi">5</span><span class="p">:</span><span class="n">iSOF</span><span class="o">+</span><span class="mi">9</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span>

<span class="k">def</span> <span class="nf">_gifxy</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;read the (width, height) from a GIF header&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;HH&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>

    <span class="n">_read_flags</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span>
    <span class="n">_FMT_JPEG</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;jpeg&#39;</span>
    <span class="n">_FMT_PNG</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;png&#39;</span>
    <span class="n">_FMT_GIF</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;gif&#39;</span>
    <span class="n">_ACCEPTABLE_EMBEDDINGS</span> <span class="o">=</span> <span class="p">[</span><span class="n">_FMT_JPEG</span><span class="p">,</span> <span class="n">_FMT_PNG</span><span class="p">,</span> <span class="n">_FMT_GIF</span><span class="p">]</span>
    <span class="n">_MIMETYPES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">_FMT_PNG</span><span class="p">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span>
        <span class="n">_FMT_JPEG</span><span class="p">:</span> <span class="s1">&#39;image/jpeg&#39;</span><span class="p">,</span>
        <span class="n">_FMT_GIF</span><span class="p">:</span> <span class="s1">&#39;image/gif&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">embed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">retina</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">unconfined</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a PNG/JPEG/GIF image object given raw data.</span>

<span class="sd">        When this object is returned by an input cell or passed to the</span>
<span class="sd">        display function, it will result in the image being displayed</span>
<span class="sd">        in the frontend.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The raw image data or a URL or filename to load the data from.</span>
<span class="sd">            This always results in embedded image data.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL to download the data from. If you specify `url=`,</span>
<span class="sd">            the image data will not be embedded unless you also specify `embed=True`.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file to load the data from.</span>
<span class="sd">            Images from a file are always embedded.</span>
<span class="sd">        format : unicode</span>
<span class="sd">            The format of the image data (png/jpeg/jpg/gif). If a filename or URL is given</span>
<span class="sd">            for format will be inferred from the filename extension.</span>
<span class="sd">        embed : bool</span>
<span class="sd">            Should the image data be embedded using a data URI (True) or be</span>
<span class="sd">            loaded using an &lt;img&gt; tag. Set this to True if you want the image</span>
<span class="sd">            to be viewable later with no internet connection in the notebook.</span>

<span class="sd">            Default is `True`, unless the keyword argument `url` is set, then</span>
<span class="sd">            default value is `False`.</span>

<span class="sd">            Note that QtConsole is not able to display images if `embed` is set to `False`</span>
<span class="sd">        width : int</span>
<span class="sd">            Width in pixels to which to constrain the image in html</span>
<span class="sd">        height : int</span>
<span class="sd">            Height in pixels to which to constrain the image in html</span>
<span class="sd">        retina : bool</span>
<span class="sd">            Automatically set the width and height to half of the measured</span>
<span class="sd">            width and height.</span>
<span class="sd">            This only works for embedded images because it reads the width/height</span>
<span class="sd">            from image data.</span>
<span class="sd">            For non-embedded images, you can just set the desired display width</span>
<span class="sd">            and height directly.</span>
<span class="sd">        unconfined: bool</span>
<span class="sd">            Set unconfined=True to disable max-width confinement of the image.</span>
<span class="sd">        metadata: dict</span>
<span class="sd">            Specify extra metadata to attach to the image.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        # embedded image data, works in qtconsole and notebook</span>
<span class="sd">        # when passed positionally, the first arg can be any of raw image data,</span>
<span class="sd">        # a URL, or a filename from which to load image data.</span>
<span class="sd">        # The result is always embedding image data for inline images.</span>
<span class="sd">        Image(&#39;http://www.google.fr/images/srpr/logo3w.png&#39;)</span>
<span class="sd">        Image(&#39;/path/to/image.jpg&#39;)</span>
<span class="sd">        Image(b&#39;RAW_PNG_DATA...&#39;)</span>

<span class="sd">        # Specifying Image(url=...) does not embed the image data,</span>
<span class="sd">        # it only generates `&lt;img&gt;` tag with a link to the source.</span>
<span class="sd">        # This will not work in the qtconsole or offline.</span>
<span class="sd">        Image(url=&#39;http://www.google.fr/images/srpr/logo3w.png&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ext</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No image data found. Expecting filename, url, or data.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_safe_exists</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_ext</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">&#39;jpg&#39;</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">&#39;jpeg&#39;</span><span class="p">:</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_JPEG</span>
                <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">&#39;png&#39;</span><span class="p">:</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_PNG</span>
                <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">&#39;gif&#39;</span><span class="p">:</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_GIF</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="c1"># infer image type from image data header,</span>
                <span class="c1"># only if format has not been specified.</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">_JPEG</span><span class="p">:</span>
                    <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_JPEG</span>

        <span class="c1"># failed to detect format, default png</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_PNG</span>

        <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;jpg&#39;</span><span class="p">:</span>
            <span class="c1"># jpg-&gt;jpeg</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_JPEG</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span> <span class="k">if</span> <span class="n">embed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ACCEPTABLE_EMBEDDINGS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot embed the &#39;</span><span class="si">%s</span><span class="s2">&#39; image format&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mimetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MIMETYPES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retina</span> <span class="o">=</span> <span class="n">retina</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span> <span class="o">=</span> <span class="n">unconfined</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Image</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> 
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">retina</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_retina_shape</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_retina_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;load pixel-doubled width and height from image data&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_PNG</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_pngxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_JPEG</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_jpegxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_GIF</span><span class="p">:</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_gifxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># retina only supports png</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reload the raw data from file or URL.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Image</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">retina</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_retina_shape</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">=</span> <span class="n">klass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="s1">&#39; width=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="s1">&#39; height=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span><span class="p">:</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="s1">&#39; class=&quot;unconfined&quot;&#39;</span>
            <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&lt;img src=&quot;</span><span class="si">{url}</span><span class="s1">&quot;</span><span class="si">{width}{height}{klass}</span><span class="s1">/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">klass</span><span class="o">=</span><span class="n">klass</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_mimebundle_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the image as a mimebundle</span>

<span class="sd">        Any new mimetype support should be implemented here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">mimetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mimetype</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">(</span><span class="n">always_both</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="n">metadata</span><span class="p">}</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="n">data</span><span class="p">},</span> <span class="n">metadata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;text/html&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repr_html_</span><span class="p">()}</span>

    <span class="k">def</span> <span class="nf">_data_and_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">always_both</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;shortcut for returning metadata with shape information, if defined&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">b64_data</span> <span class="o">=</span> <span class="n">b2a_base64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="s2">&quot;No such file or directory: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span>
            <span class="n">md</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="s1">&#39;unconfined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unconfined</span>
        <span class="k">if</span> <span class="n">md</span> <span class="ow">or</span> <span class="n">always_both</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b64_data</span><span class="p">,</span> <span class="n">md</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b64_data</span>

    <span class="k">def</span> <span class="nf">_repr_png_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_PNG</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_repr_jpeg_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_FMT_JPEG</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_and_metadata</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_find_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ext</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">base</span>

        <span class="c1"># `splitext` includes leading period, so we skip it</span>
        <span class="k">return</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Video</span><span class="p">(</span><span class="n">DisplayObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">mimetype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">html_attributes</span><span class="o">=</span><span class="s2">&quot;controls&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a video object given raw data or an URL.</span>

<span class="sd">        When this object is returned by an input cell or passed to the</span>
<span class="sd">        display function, it will result in the video being displayed</span>
<span class="sd">        in the frontend.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : unicode, str or bytes</span>
<span class="sd">            The raw video data or a URL or filename to load the data from.</span>
<span class="sd">            Raw data will require passing ``embed=True``.</span>
<span class="sd">        url : unicode</span>
<span class="sd">            A URL for the video. If you specify ``url=``,</span>
<span class="sd">            the image data will not be embedded.</span>
<span class="sd">        filename : unicode</span>
<span class="sd">            Path to a local file containing the video.</span>
<span class="sd">            Will be interpreted as a local URL unless ``embed=True``.</span>
<span class="sd">        embed : bool</span>
<span class="sd">            Should the video be embedded using a data URI (True) or be</span>
<span class="sd">            loaded using a &lt;video&gt; tag (False).</span>

<span class="sd">            Since videos are large, embedding them should be avoided, if possible.</span>
<span class="sd">            You must confirm embedding as your intention by passing ``embed=True``.</span>

<span class="sd">            Local files can be displayed with URLs without embedding the content, via::</span>

<span class="sd">                Video(&#39;./video.mp4&#39;)</span>

<span class="sd">        mimetype: unicode</span>
<span class="sd">            Specify the mimetype for embedded videos.</span>
<span class="sd">            Default will be guessed from file extension, if available.</span>
<span class="sd">        width : int</span>
<span class="sd">            Width in pixels to which to constrain the video in HTML.</span>
<span class="sd">            If not supplied, defaults to the width of the video.</span>
<span class="sd">        height : int</span>
<span class="sd">            Height in pixels to which to constrain the video in html.</span>
<span class="sd">            If not supplied, defaults to the height of the video.</span>
<span class="sd">        html_attributes : str</span>
<span class="sd">            Attributes for the HTML ``&lt;video&gt;`` block.</span>
<span class="sd">            Default: ``&quot;controls&quot;`` to get video controls.</span>
<span class="sd">            Other examples: ``&quot;controls muted&quot;`` for muted video with controls,</span>
<span class="sd">            ``&quot;loop autoplay&quot;`` for looping autoplaying video without controls.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        ::</span>

<span class="sd">            Video(&#39;https://archive.org/download/Sita_Sings_the_Blues/Sita_Sings_the_Blues_small.mp4&#39;)</span>
<span class="sd">            Video(&#39;path/to/video.mp4&#39;)</span>
<span class="sd">            Video(&#39;path/to/video.mp4&#39;, embed=True)</span>
<span class="sd">            Video(&#39;path/to/video.mp4&#39;, embed=True, html_attributes=&quot;controls muted autoplay&quot;)</span>
<span class="sd">            Video(b&#39;raw-videodata&#39;, embed=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">Path</span><span class="p">,</span> <span class="n">PurePath</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;http:&#39;</span><span class="p">,</span> <span class="s1">&#39;https:&#39;</span><span class="p">)):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">embed</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s2">&quot;To embed videos, you must pass embed=True &quot;</span><span class="p">,</span>
                <span class="s2">&quot;(this may make your notebook files huge)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Consider passing Video(url=&#39;...&#39;)&quot;</span><span class="p">,</span>
            <span class="p">])</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mimetype</span> <span class="o">=</span> <span class="n">mimetype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html_attributes</span> <span class="o">=</span> <span class="n">html_attributes</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Video</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="s1">&#39; width=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="s1">&#39; height=&quot;</span><span class="si">%d</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>

        <span class="c1"># External URLs and potentially local files are not embedded into the</span>
        <span class="c1"># notebook output.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;video src=&quot;</span><span class="si">{0}</span><span class="s2">&quot; </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2"> </span><span class="si">{3}</span><span class="s2">&gt;</span>
<span class="s2">      Your browser does not support the &lt;code&gt;video&lt;/code&gt; element.</span>
<span class="s2">    &lt;/video&gt;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">html_attributes</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span>

        <span class="c1"># Embedded videos are base64-encoded.</span>
        <span class="n">mimetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mimetype</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">mimetype</span><span class="p">:</span>
                <span class="n">mimetype</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">video</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">video</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">video</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># unicode input is already b64-encoded</span>
            <span class="n">b64_video</span> <span class="o">=</span> <span class="n">video</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b64_video</span> <span class="o">=</span> <span class="n">b2a_base64</span><span class="p">(</span><span class="n">video</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;video </span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> </span><span class="si">{2}</span><span class="s2">&gt;</span>
<span class="s2"> &lt;source src=&quot;data:</span><span class="si">{3}</span><span class="s2">;base64,</span><span class="si">{4}</span><span class="s2">&quot; type=&quot;</span><span class="si">{3}</span><span class="s2">&quot;&gt;</span>
<span class="s2"> Your browser does not support the video tag.</span>
<span class="s2"> &lt;/video&gt;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">html_attributes</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">mimetype</span><span class="p">,</span> <span class="n">b64_video</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">reload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO</span>
        <span class="k">pass</span>


<span class="k">def</span> <span class="nf">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear the output of the current cell receiving output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wait : bool [default: false]</span>
<span class="sd">        Wait to clear the output until new output is available to replace it.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
    <span class="k">if</span> <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">initialized</span><span class="p">():</span>
        <span class="n">InteractiveShell</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">display_pub</span><span class="o">.</span><span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[2K</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[2K</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>


<span class="nd">@skip_doctest</span>
<span class="k">def</span> <span class="nf">set_matplotlib_formats</span><span class="p">(</span><span class="o">*</span><span class="n">formats</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. deprecated:: 7.23</span>

<span class="sd">       use `matplotlib_inline.backend_inline.set_matplotlib_formats()`</span>

<span class="sd">    Select figure formats for the inline backend. Optionally pass quality for JPEG.</span>

<span class="sd">    For example, this enables PNG and JPEG output with a JPEG quality of 90%::</span>

<span class="sd">        In [1]: set_matplotlib_formats(&#39;png&#39;, &#39;jpeg&#39;, quality=90)</span>

<span class="sd">    To set this in your config files use the following::</span>

<span class="sd">        c.InlineBackend.figure_formats = {&#39;png&#39;, &#39;jpeg&#39;}</span>
<span class="sd">        c.InlineBackend.print_figure_kwargs.update({&#39;quality&#39; : 90})</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *formats : strs</span>
<span class="sd">        One or more figure formats to enable: &#39;png&#39;, &#39;retina&#39;, &#39;jpeg&#39;, &#39;svg&#39;, &#39;pdf&#39;.</span>
<span class="sd">    **kwargs :</span>
<span class="sd">        Keyword args will be relayed to ``figure.canvas.print_figure``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;`set_matplotlib_formats` is deprecated since IPython 7.23, directly &quot;</span>
        <span class="s2">&quot;use `matplotlib_inline.backend_inline.set_matplotlib_formats()`&quot;</span><span class="p">,</span>
        <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">matplotlib_inline.backend_inline</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">set_matplotlib_formats</span> <span class="k">as</span> <span class="n">set_matplotlib_formats_orig</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">set_matplotlib_formats_orig</span><span class="p">(</span><span class="o">*</span><span class="n">formats</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nd">@skip_doctest</span>
<span class="k">def</span> <span class="nf">set_matplotlib_close</span><span class="p">(</span><span class="n">close</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .. deprecated:: 7.23</span>

<span class="sd">        use `matplotlib_inline.backend_inline.set_matplotlib_close()`</span>


<span class="sd">    Set whether the inline backend closes all figures automatically or not.</span>

<span class="sd">    By default, the inline backend used in the IPython Notebook will close all</span>
<span class="sd">    matplotlib figures automatically after each cell is run. This means that</span>
<span class="sd">    plots in different cells won&#39;t interfere. Sometimes, you may want to make</span>
<span class="sd">    a plot in one cell and then refine it in later cells. This can be accomplished</span>
<span class="sd">    by::</span>

<span class="sd">        In [1]: set_matplotlib_close(False)</span>

<span class="sd">    To set this in your config files use the following::</span>

<span class="sd">        c.InlineBackend.close_figures = False</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    close : bool</span>
<span class="sd">        Should all matplotlib figures be automatically closed after each cell is</span>
<span class="sd">        run?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
        <span class="s2">&quot;`set_matplotlib_close` is deprecated since IPython 7.23, directly &quot;</span>
        <span class="s2">&quot;use `matplotlib_inline.backend_inline.set_matplotlib_close()`&quot;</span><span class="p">,</span>
        <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="kn">from</span> <span class="nn">matplotlib_inline.backend_inline</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">set_matplotlib_close</span> <span class="k">as</span> <span class="n">set_matplotlib_close_orig</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">set_matplotlib_close_orig</span><span class="p">(</span><span class="n">close</span><span class="p">)</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Erik Ingwersen
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/tabs.js"></script>
    </body>
</html>